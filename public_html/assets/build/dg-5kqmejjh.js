var h,x,S,b;if(typeof naja<"u"){var _=function(){return naja&&naja.VERSION&&naja.VERSION>=2},k=function(e){return _()?e.detail:e},O=function(e){return _()?e.detail.request:e.xhr};h=function(e,t){var i=t.init,n=t.success,r=t.before,d=t.complete,o=t.interaction,l=function(s,g){return this.name=g,this.initialize=function(u){i&&u.addEventListener("init",function(a){i(k(a).defaultOptions)}),n&&u.addEventListener("success",function(a){var m=_()?a.detail.payload:a.response;n(m,k(a).options)});var c=u;_()&&(c=c.uiHandler),c.addEventListener("interaction",function(a){_()?a.detail.options.nette={el:$(a.detail.element)}:a.options.nette={el:$(a.element)},o&&(o(k(a).options)||a.preventDefault())}),r&&u.addEventListener("before",function(a){r(O(a),k(a).options)||a.preventDefault()}),d&&u.addEventListener("complete",function(a){d(O(a),k(a).options)})},_()||this.initialize(s),this};_()?naja.registerExtension(new l(null,e)):naja.registerExtension(l,e)},x=function(e){var t=e.type||"GET",i=e.data||null;naja.makeRequest(t,e.url,i,{}).then(e.success).catch(e.error)},S=function(){naja.load()},b=function(e){return naja.uiHandler.submitForm(e.get(0))}}else if($.nette)h=function(e,t){$.nette.ext(e,t)},x=function(e){$.nette.ajax(e)},S=function(){$.nette.load()},b=function(e){return e.submit()};else throw new Error("Include Naja.js or nette.ajax for datagrids to work!");var A,L,q,M,C,T,D=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};$(document).on("click","[data-datagrid-confirm]:not(.ajax)",function(e){if(!confirm($(e.target).closest("a").attr("data-datagrid-confirm")))return e.stopPropagation(),e.preventDefault()});typeof naja<"u"?h("datagrid.confirm",{interaction:function(e){var t;return e.nette&&(t=e.nette.el.data("datagrid-confirm"),t)?confirm(t):!0}}):h("datagrid.confirm",{before:function(e,t){var i;return t.nette&&(i=t.nette.el.data("datagrid-confirm"),i)?confirm(i):!0}});$(document).on("change","select[data-autosubmit-per-page]",function(){var e;return e=$(this).parent().find("input[type=submit]"),e.length===0&&(e=$(this).parent().find("button[type=submit]")),e.click()}).on("change","select[data-autosubmit]",function(){return b($(this).closest("form").first())}).on("change","input[data-autosubmit][data-autosubmit-change]",function(e){var t;return e.which||e.keyCode,clearTimeout(window.datagrid_autosubmit_timer),t=$(this),window.datagrid_autosubmit_timer=setTimeout(function(i){return function(){return b(t.closest("form").first())}}(),200)}).on("keyup","input[data-autosubmit]",function(e){var t,i;if(i=e.which||e.keyCode||0,!(i!==13&&(i>=9&&i<=40||i>=112&&i<=123)))return clearTimeout(window.datagrid_autosubmit_timer),t=$(this),window.datagrid_autosubmit_timer=setTimeout(function(n){return function(){return b(t.closest("form").first())}}(),200)}).on("keydown",".datagrid-inline-edit input",function(e){var t;if(t=e.which||e.keyCode||0,t===13)return e.stopPropagation(),e.preventDefault(),$(this).closest("tr").find('.col-action-inline-edit [name="inline_edit[submit]"]').click()});$(document).on("keydown","input[data-datagrid-manualsubmit]",function(e){var t;if(t=e.which||e.keyCode||0,t===13)return e.stopPropagation(),e.preventDefault(),b($(this).closest("form").first())});T=function(e){var t,i;if(D.call(e,i)>=0)return e.path;for(i=[],t=e.target;t!==document.body&&t!==null;)i.push(t),t=t.parentNode;return i};q=function(){var e;return e=null,document.addEventListener("click",function(t){var i,n,r,d,o,l,f,s,g,u,c,a,m,p,v,E,y,I,w;for(v=T(t),o=0,a=v.length;o<a;o++)if(r=v[o],$(r).is(".col-checkbox")&&e&&t.shiftKey){if(n=$(r).closest("tr"),u=e.closest("tr"),c=u.closest("tbody"),i=c.find("tr").toArray(),n.index()>u.index()?w=i.slice(u.index(),n.index()):n.index()<u.index()&&(w=i.slice(n.index()+1,u.index())),!w)return;for(s=0,m=w.length;s<m;s++)I=w[s],f=$(I).find(".col-checkbox input[type=checkbox]")[0],f&&(f.checked=!0,l=window.navigator.userAgent.indexOf("MSIE "),l?(d=document.createEvent("Event"),d.initEvent("change",!0,!0)):d=new Event("change",{bubbles:!0}),f.dispatchEvent(d))}for(E=T(t),y=[],g=0,p=E.length;g<p;g++)r=E[g],$(r).is(".col-checkbox")?y.push(e=$(r)):y.push(void 0);return y})};q();document.addEventListener("change",function(e){var t,i,n,r,d,o,l,f,s,g,u,c,a;if(d=e.target.getAttribute("data-check"),d&&(i=document.querySelectorAll("input[data-check-all-"+d+"]:checked"),c=document.querySelector(".datagrid-"+d+' select[name="group_action[group_action]"]'),t=document.querySelectorAll(".datagrid-"+d+' .row-group-actions *[type="submit"]'),n=document.querySelector(".datagrid-"+d+" .datagrid-selected-rows-count"),i.length?(t&&t.forEach(function(m){m.disabled=!1}),c&&(c.disabled=!1),a=document.querySelectorAll("input[data-check-all-"+d+"]").length,n&&(n.innerHTML=i.length+"/"+a)):(t&&t.forEach(function(m){m.disabled=!0}),c&&(c.disabled=!0,c.value=""),n&&(n.innerHTML="")),l=window.navigator.userAgent.indexOf("MSIE "),l?(r=document.createEvent("Event"),r.initEvent("change",!0,!0)):r=new Event("change",{bubbles:!0}),c&&c.dispatchEvent(r)),d=e.target.getAttribute("data-check-all"),d){for(s=document.querySelectorAll("input[type=checkbox][data-check-all-"+d+"]"),u=[],o=0,g=s.length;o<g;o++)f=s[o],f.checked=e.target.checked,l=window.navigator.userAgent.indexOf("MSIE "),l?(r=document.createEvent("Event"),r.initEvent("change",!0,!0)):r=new Event("change",{bubbles:!0}),u.push(f.dispatchEvent(r));return u}});window.datagridSerializeUrl=function(e,t){var i=[];for(var n in e)if(e.hasOwnProperty(n)){var r=t?t+"["+n+"]":n,d=e[n];if(d!==null&&d!=="")if(typeof d=="object"){var o=window.datagridSerializeUrl(d,r);o&&i.push(o)}else i.push(encodeURIComponent(r)+"="+encodeURIComponent(d))}return i.join("&")};M=function(){if(!(typeof $.fn.sortable>"u"))return $(".datagrid [data-sortable]").sortable({handle:".handle-sort",items:"tr",axis:"y",update:function(e,t){var i,n,r,d,o,l,f;return l=t.item.closest("tr[data-id]"),r=l.data("id"),o=null,d=null,l.prev().length&&(o=l.prev().data("id")),l.next().length&&(d=l.next().data("id")),f=$(this).data("sortable-url"),n={},i=l.closest(".datagrid").find("tbody").attr("data-sortable-parent-path"),n[(i+"-item_id").replace(/^-/,"")]=r,o!==null&&(n[(i+"-prev_id").replace(/^-/,"")]=o),d!==null&&(n[(i+"-next_id").replace(/^-/,"")]=d),x({type:"GET",url:f,data:n,error:function(s,g,u){return alert(s.statusText)}})},helper:function(e,t){return t.children().each(function(){return $(this).width($(this).width())}),t}})};$(function(){return M()});typeof C>"u"&&(C=function(){if(!(typeof $(".datagrid-tree-item-children").sortable>"u"))return $(".datagrid-tree-item-children").sortable({handle:".handle-sort",items:".datagrid-tree-item:not(.datagrid-tree-header)",toleranceElement:"> .datagrid-tree-item-content",connectWith:".datagrid-tree-item-children",update:function(e,t){var i,n,r,d,o,l,f,s,g;if($(".toggle-tree-to-delete").remove(),s=t.item.closest(".datagrid-tree-item[data-id]"),r=s.data("id"),f=null,d=null,l=null,s.prev().length&&(f=s.prev().data("id")),s.next().length&&(d=s.next().data("id")),o=s.parent().closest(".datagrid-tree-item"),o.length&&(o.find(".datagrid-tree-item-children").first().css({display:"block"}),o.addClass("has-children"),l=o.data("id")),g=$(this).data("sortable-url"),!!g)return o.find("[data-toggle-tree]").first().removeClass("hidden"),i=s.closest(".datagrid-tree").attr("data-sortable-parent-path"),n={},n[(i+"-item_id").replace(/^-/,"")]=r,f!==null&&(n[(i+"-prev_id").replace(/^-/,"")]=f),d!==null&&(n[(i+"-next_id").replace(/^-/,"")]=d),n[(i+"-parent_id").replace(/^-/,"")]=l,x({type:"GET",url:g,data:n,error:function(u,c,a){if(a!=="abort")return alert(u.statusText)}})},stop:function(e,t){return $(".toggle-tree-to-delete").removeClass("toggle-tree-to-delete")},start:function(e,t){var i;if(i=t.item.parent().closest(".datagrid-tree-item"),i.length&&i.find(".datagrid-tree-item").length===2)return i.find("[data-toggle-tree]").addClass("toggle-tree-to-delete")}})});$(function(){return C()});h("datagrid.happy",{success:function(){var e,t,i,n,r,d,o,l,f,s,g,u,c,a;for(window.happy&&window.happy.reset(),o=$(".datagrid"),a=[],l=0,u=o.length;l<u;l++){for(d=o[l],n=d.classList,i="",g=0,c=n.length;g<c;g++)e=n[g],i=i+"."+e;t=document.querySelectorAll(i+" input[data-check]:checked"),t.length===1&&t[0].getAttribute("name")==="toggle-all"?(s=document.querySelector(i+" input[name=toggle-all]"),s?(s.checked=!1,f=window.navigator.userAgent.indexOf("MSIE "),f?(r=document.createEvent("Event"),r.initEvent("change",!0,!0)):r=new Event("change",{bubbles:!0}),a.push(s.dispatchEvent(r))):a.push(void 0)):a.push(void 0)}return a}});h("datagrid.sortable",{success:function(){return M()}});h("datagrid.forms",{success:function(){return $(".datagrid").find("form").each(function(){return window.Nette.initForm(this)})}});h("datagrid.url",{success:function(e){var t,i,n,r;if(e._datagrid_url&&window.history.replaceState&&(t=window.location.protocol+"//"+window.location.host,i=window.location.pathname,n=window.datagridSerializeUrl(e.state).replace(/&+$/gm,""),n?r=t+i+"?"+n.replace(/\&*$/,""):r=t+i,r+=window.location.hash,window.location.href!==r))return window.history.replaceState({path:r},"",r)}});h("datagrid.sort",{success:function(e){var t,i,n,r;if(e._datagrid_sort){n=e._datagrid_sort,r=[];for(i in n)t=n[i],r.push($("#datagrid-sort-"+i).attr("href",t));return r}}});h("datargid.item_detail",{before:function(e,t){var i,n,r;return t.nette&&t.nette.el.attr("data-toggle-detail")?(i=t.nette.el.attr("data-toggle-detail"),r=t.nette.el.attr("data-toggle-detail-grid-fullname"),n=$(".item-detail-"+r+"-id-"+i),n.hasClass("loaded")?n.find(".item-detail-content").length?(n.hasClass("toggled")?n.find(".item-detail-content").slideToggle("fast",function(d){return function(){return n.toggleClass("toggled")}}()):(n.toggleClass("toggled"),n.find(".item-detail-content").slideToggle("fast")),!1):(n.removeClass("toggled"),!0):n.addClass("loaded")):!0},success:function(e){var t,i,n;if(e._datagrid_toggle_detail&&e._datagrid_name)return t=e._datagrid_toggle_detail,n=e._datagrid_name,i=$(".item-detail-"+n+"-id-"+t),i.toggleClass("toggled"),i.find(".item-detail-content").slideToggle("fast")}});h("datagrid.tree",{before:function(e,t){var i;return t.nette&&t.nette.el.attr("data-toggle-tree")&&(t.nette.el.toggleClass("toggle-rotate"),i=t.nette.el.closest(".datagrid-tree-item").find(".datagrid-tree-item-children").first(),i.hasClass("loaded"))?(i.slideToggle("fast"),!1):!0},success:function(e){var t,i,n,r,d,o,l;if(e._datagrid_tree){n=e._datagrid_tree,t=$('.datagrid-tree-item[data-id="'+n+'"]').find(".datagrid-tree-item-children").first(),t.addClass("loaded"),d=e.snippets;for(r in d)o=d[r],i=$(o),l=$('<div class="datagrid-tree-item" id="'+r+'">'),l.attr("data-id",i.attr("data-id")),l.append(i),i.data("has-children")&&l.addClass("has-children"),t.append(l);t.addClass("loaded"),t.slideToggle("fast"),S()}return C()}});$(document).on("click","[data-datagrid-editable-url]",function(e){var t,i,n,r,d,o,l,f,s,g,u,c;if(r=$(this),e.target.tagName.toLowerCase()!=="a"&&!r.hasClass("datagrid-inline-edit")&&!r.hasClass("editing")){r.addClass("editing"),d=r.html().trim().replace("<br>",`
`),r.attr("data-datagrid-editable-value")?c=r.data("datagrid-editable-value"):c=d,r.data("originalValue",d),r.data("valueToEdit",c),r.data("datagrid-editable-type")==="textarea"?(s=$("<textarea>"+c+"</textarea>"),f=parseInt(r.css("padding").replace(/[^-\d\.]/g,""),10),o=r.outerHeight(),g=Math.round(parseFloat(r.css("line-height"))),l=(o-2*f)/g,s.attr("rows",Math.round(l))):r.data("datagrid-editable-type")==="select"?(s=$(r.data("datagrid-editable-element")),s.find("option[value='"+c+"']").prop("selected",!0)):(s=$('<input type="'+r.data("datagrid-editable-type")+'">'),s.val(c)),n=r.data("datagrid-editable-attrs");for(t in n)i=n[t],s.attr(t,i);return r.removeClass("edited"),r.html(s),u=function(a,m){var p;return p=m.val(),p!==a.data("valueToEdit")?x({url:a.data("datagrid-editable-url"),data:{value:p},type:"POST",success:function(v){return a.data("datagrid-editable-type")==="select"?a.html(s.find("option[value='"+p+"']").html()):(v._datagrid_editable_new_value&&(p=v._datagrid_editable_new_value),a.html(p)),a.addClass("edited")},error:function(){return a.html(a.data("originalValue")),a.addClass("edited-error")}}):a.html(a.data("originalValue")),setTimeout(function(){return a.removeClass("editing")},1200)},r.find("input,textarea,select").focus().on("blur",function(){return u(r,$(this))}).on("keydown",function(a){if(r.data("datagrid-editable-type")!=="textarea"&&a.which===13)return a.stopPropagation(),a.preventDefault(),u(r,$(this));if(a.which===27)return a.stopPropagation(),a.preventDefault(),r.removeClass("editing"),r.html(r.data("originalValue"))}),r.find("select").on("change",function(){return u(r,$(this))})}});h("datagrid.after_inline_edit",{success:function(e){var t=$(".datagrid-"+e._datagrid_name);if(e._datagrid_inline_edited)return t.find("tr[data-id="+e._datagrid_inline_edited+"] > td").addClass("edited"),t.find(".datagrid-inline-edit-trigger").removeClass("hidden");if(e._datagrid_inline_edit_cancel)return t.find(".datagrid-inline-edit-trigger").removeClass("hidden")}});$(document).on("mouseup","[data-datagrid-cancel-inline-add]",function(e){var t=e.which||e.keyCode||0;if(t===1)return e.stopPropagation(),e.preventDefault(),$(".datagrid-row-inline-add").addClass("datagrid-row-inline-add-hidden")});h("datagrid-toggle-inline-add",{success:function(e){var t=$(".datagrid-"+e._datagrid_name);if(e._datagrid_inline_adding){var i=t.find(".datagrid-row-inline-add");i.hasClass("datagrid-row-inline-add-hidden")&&i.removeClass("datagrid-row-inline-add-hidden"),i.find("input:not([readonly]),textarea:not([readonly])").first().focus()}}});A=function(){var e=$(".selectpicker").first();if($.fn.selectpicker)return $.fn.selectpicker.defaults={countSelectedText:e.data("i18n-selected"),iconBase:"",tickIcon:e.data("selected-icon-check")}};$(function(){return A()});L=function(){var e;if($.fn.selectpicker)return e=$("[data-datagrid-multiselect-id]"),e.each(function(){var t;if($(this).hasClass("selectpicker"))return $(this).removeAttr("id"),t=$(this).data("datagrid-multiselect-id"),$(this).on("loaded.bs.select",function(i){return $(this).parent().attr("style","display:none;"),$(this).parent().find(".hidden").removeClass("hidden").addClass("btn-default btn-secondary")}),$(this).on("rendered.bs.select",function(i){return $(this).parent().attr("id",t)})})};$(function(){return L()});h("datagrid.fitlerMultiSelect",{success:function(){if(A(),$.fn.selectpicker)return $(".selectpicker").selectpicker({iconBase:"fa"})}});h("datagrid.groupActionMultiSelect",{success:function(){return L()}});h("datagrid.inline-editing",{success:function(e){var t;if(e._datagrid_inline_editing)return t=$(".datagrid-"+e._datagrid_name),t.find(".datagrid-inline-edit-trigger").addClass("hidden")}});h("datagrid.redraw-item",{success:function(e){var t;if(e._datagrid_redraw_item_class)return t=$("tr[data-id="+e._datagrid_redraw_item_id+"]"),t.attr("class",e._datagrid_redraw_item_class)}});h("datagrid.reset-filter-by-column",{success:function(e){var t,i,n,r,d,o;if(e._datagrid_name&&(t=$(".datagrid-"+e._datagrid_name),t.find("[data-datagrid-reset-filter-by-column]").addClass("hidden"),e.non_empty_filters&&e.non_empty_filters.length)){for(o=e.non_empty_filters,n=0,d=o.length;n<d;n++)r=o[n],t.find("[data-datagrid-reset-filter-by-column="+r+"]").removeClass("hidden");return i=t.find(".reset-filter").attr("href"),t.find("[data-datagrid-reset-filter-by-column]").each(function(){var l;return r=$(this).attr("data-datagrid-reset-filter-by-column"),l=i.replace("do="+e._datagrid_name+"-resetFilter","do="+e._datagrid_name+"-resetColumnFilter"),l+="&"+e._datagrid_name+"-key="+r,$(this).attr("href",l)})}}});
